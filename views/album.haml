#wrapper
  :css
    #title, #desc, #zip, .caption {
      font-family: '#{@album.font_family}', sans-serif !important;
    }

  - if @album.config(:zip)
    %a#zip{:href => "/#{@album.name}/zip"}
      .icon-cloud-download
      = t.download.all

  #title
    = h @album.config(:title)
    #desc= h @album.config(:desc)

  #container
    - @photos.each do |photo|
      - if @album.config(:section) and not @album.config(:section)[photo.id].nil?
        .section
          %img{:src => "/img/transparent.gif"}
          .caption=@album.config(:section)[photo.id]
      %a.item{:"data-fancybox" => "photo", :id => "photo-#{photo.id.to_i}", :href => preview(photo), :"data-width" => photo.size(:preview).x, :"data-height" => photo.size(:preview).y, :"data-download-url" => original(photo)}<>
        %img.lazy{:src => embedded(photo), :"data-original" => thumb(photo), :width => photo.size(:thumb).x, :height => photo.size(:thumb).y}

:javascript

  $("img.lazy").lazyload();

  $("#container").justifiedGallery({
    rowHeight: #{@album.config(:thumb)} / 1.5,
    margins: 5,
    waitThumbnailsLoad: false,
    cssAnimation: false,
    lastRow: "nojustify"
  });

  $.fancybox.defaults.hash = "photo";
  $.fancybox.defaults.thumbs = false;
  $.fancybox.defaults.loop = false;
  $.fancybox.defaults.opacity = false;
  // $.fancybox.defaults.image.preload = false;

  $.fancybox.defaults.onInit = function( instance ) {
    instance.$refs.downloadButton = $('<a class="fancybox-button"><div class="download icon"></div></a>')
      .appendTo( instance.$refs.buttons );
  }

  $.fancybox.defaults.beforeMove = function( instance, current ) {
    if (current.opts.$orig) {
      instance.$refs.downloadButton.attr('href', current.opts.$orig.attr('data-download-url'));
      instance.$refs.downloadButton.attr('target', $('body').hasClass('touch_device') ? '_blank' : '_self');
    }
  }

