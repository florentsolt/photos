:css
  #title, #desc, #zip, .caption {
    font-family: '#{@album.font_family}', sans-serif !important;
  }

- if @album.config(:zip)
  %a#zip{:href => "/#{@album.name}/zip"}
    .icon-cloud-download
    = t.download.all

#title
  = h @album.config(:title)
  #desc= h @album.config(:desc)

#container
  = haml(:page)

:plain
  <div id="blueimp-gallery" class="blueimp-gallery">
      <div class="slides"></div>
      <h3 class="title"></h3>
      <a class="prev">‹</a>
      <a class="next">›</a>
      <a class="close">×</a>
  </div>


:javascript

  $("#container").justifiedGallery({
    rowHeight: #{@album.config(:thumb)} / 1.5,
    margins: 5,
    waitThumbnailsLoad: false,
    cssAnimation: true,
    lastRow: "justify"
  });

  document.getElementById('container').onclick = function (event) {
      event = event || window.event;
      var target = event.target || event.srcElement,
          link = target.src ? target.parentNode : target,
          options = {
            index: link,
            event: event
          },
          links = this.getElementsByTagName('a');
      blueimp.Gallery(links, options);
  };

  var id = parseInt(window.location.hash.substr(1));
  if (id >= 0) {
    $('#' + id + ' img').click();
  }

  var page = 1;
  var end = false;
  var wait = false;
  $(window).scroll(function() {
      if(end === false && wait === false && $(window).scrollTop() + $(window).height() + #{@album.config(:thumb)} >= $(document).height()) {
        wait = true;
        $('<div>').load("/#{@album.name}/page/" + page, function(html, status) {
          if (status == 'error') {
            if (html == 'No more pictures') {
              end = true;
            } else {
              // Do not page++, that's it
            }
          } else {
            $("#container").append($(this).html());
            $('#container').justifiedGallery('norewind');
            page++;
          }
          wait = false;
        });
      }
  });
